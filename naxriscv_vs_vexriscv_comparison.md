# NaxRiscv vs VexRiscv Setup Comparison

## Clear Answer to Your Questions

### ❌ **NO, you don't need to run any .sh file**
- I already fixed your DTS file directly (line 10)
- You just need to **recompile the DTB**:
  ```bash
  cd /home/riscv_dev/build/alinx_ax7203
  dtc -I dts -O dtb -o linux.dtb linux.dts
  ```
- Then copy the new `linux.dtb` to your SD card

---

## Key Differences: Your Setup vs VexRiscv Reference

### 1. **CRITICAL: Early Console Configuration**

**VexRiscv Reference (linux-on-litex-vexriscv):**
```
CONFIG_SERIAL_EARLYCON_RISCV_SBI=y
```
- Uses **SBI (OpenSBI) console** for early boot messages
- Kernel talks to OpenSBI, which talks to UART
- Bootargs: `earlycon=sbi` (not `earlycon=liteuart`)

**Your Current Setup:**
```
CONFIG_SERIAL_LITEUART=y
CONFIG_SERIAL_LITEUART_CONSOLE=y
```
- Uses **LiteUART directly** for early console
- Kernel talks directly to LiteUART hardware
- Bootargs: `earlycon=liteuart,mmio32,0xf0021000` ✅ (this is correct for your setup)

**⚠️ This might be the issue!** For NaxRiscv, you might need to use SBI console instead.

---

### 2. **Architecture Differences**

**VexRiscv Reference:**
- `CONFIG_ARCH_RV32I=y` (32-bit)
- `CONFIG_RISCV_ISA_C=n` (no compressed instructions)
- `CONFIG_HVC_RISCV_SBI=y` (SBI hypervisor console)

**Your NaxRiscv:**
- `CONFIG_ARCH_RV64I=y` (64-bit) - from your DTS: `rv64i2p0_mafdc`
- Different ISA extensions
- No HVC config (you're using LiteUART directly)

---

### 3. **Interrupt Controller**

**VexRiscv Reference:**
```
CONFIG_LITEX_VEXRISCV_INTC=y
```
- Uses LiteX-specific VexRiscv interrupt controller

**Your Setup:**
- Uses standard SiFive PLIC (`sifive,fu540-c000-plic`)
- This is correct for NaxRiscv (standard RISC-V interrupt controller)

---

### 4. **Kernel Configuration Differences**

| Feature | VexRiscv Reference | Your Setup | Status |
|---------|-------------------|------------|--------|
| Early Console | `CONFIG_SERIAL_EARLYCON_RISCV_SBI=y` | `CONFIG_SERIAL_LITEUART_CONSOLE=y` | ⚠️ **Different** |
| Architecture | RV32I | RV64I | ✅ Different by design |
| Interrupt Controller | LiteX VexRiscv INTC | Standard PLIC | ✅ Different by design |
| LiteUART Driver | ✅ Enabled | ✅ Enabled | ✅ Same |
| LiteEth Driver | ✅ Enabled | ✅ Enabled | ✅ Same |
| LiteMMC Driver | ✅ Enabled | ✅ Enabled | ✅ Same |

---

### 5. **Device Tree Differences**

**VexRiscv Reference:**
- Uses `linux-on-litex-vexriscv` DTS generator
- Root device: `ram0` (RAM disk) or `mmcblk0p2` (SD card)
- Bootargs generated by their script

**Your DTS:**
- ✅ Generated from `csr.json` (correct)
- ✅ Root device: `mmcblk0p2` (correct)
- ✅ All peripherals match your hardware
- ⚠️ Bootargs format: Now using `earlycon=liteuart,mmio32,0xf0021000`

---

## The Most Likely Issue

**Your kernel is trying to use LiteUART for early console, but it might need SBI console instead.**

### Try This Fix:

**Option 1: Use SBI Console (Like VexRiscv Reference)**

1. Enable SBI early console in kernel:
   ```bash
   cd /home/riscv_dev/linux
   make ARCH=riscv CROSS_COMPILE=riscv64-linux-gnu- menuconfig
   ```
   Navigate to: `Device Drivers → Character devices → Serial drivers`
   - Enable: `Early console using RISC-V SBI`
   - This adds: `CONFIG_SERIAL_EARLYCON_RISCV_SBI=y`

2. Update DTS bootargs:
   ```dts
   bootargs = "console=ttyS0 earlycon=sbi rootwait root=/dev/mmcblk0p2";
   ```

**Option 2: Keep LiteUART Early Console (Current)**

Your current setup should work if:
- LiteUART early console is properly initialized
- UART address is correct: `0xf0021000`
- The format `earlycon=liteuart,mmio32,0xf0021000` is correct

The fact that you see nothing suggests either:
- Early console isn't working (needs SBI?)
- Kernel is crashing before printk
- UART isn't initialized yet

---

## Recommended Next Steps

1. **First, try the fixed DTS** (already done):
   - Recompile DTB
   - Boot and see if you get output

2. **If still no output, switch to SBI console**:
   - Enable `CONFIG_SERIAL_EARLYCON_RISCV_SBI=y`
   - Change bootargs to `earlycon=sbi`
   - Rebuild kernel

3. **Compare your kernel .config** with reference:
   ```bash
   diff linux/.config linux-on-litex-vexriscv/buildroot/board/litex_vexriscv/linux.config
   ```

---

## Summary

| What | VexRiscv | Your NaxRiscv | Action |
|------|----------|---------------|--------|
| Early Console | SBI (`earlycon=sbi`) | LiteUART (`earlycon=liteuart,mmio32,0xf0021000`) | Try SBI if LiteUART doesn't work |
| Architecture | 32-bit | 64-bit | ✅ Correct |
| Interrupts | LiteX-specific | Standard PLIC | ✅ Correct |
| Peripherals | Same | Same | ✅ Correct |
| Bootargs format | SBI | LiteUART (now fixed) | Try both |

**Bottom line:** The main difference is early console method. VexRiscv uses SBI, you're using LiteUART directly. If LiteUART doesn't work, try SBI.

